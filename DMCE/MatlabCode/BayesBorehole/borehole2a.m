x=[0,0;0.268,1;1,0.268];
th1=0.429;
th2=0.467;
x11=x(:,1)*ones(1,3);
x11=x11-x11';

x22=x(:,2)*ones(1,3);
x22=x22-x22';

r00 = exp(-th1*x11.^2-th2*x22.^2); 
r10 = -2*th1*[0,-0.268,-1;0.268,0,0.268-1;1,1-0.268,0].*r00;
r01 = -r10;
r20 = -2*th2*[0,-1,-0.268;1-0,0,1-0.268;0.268,0.268-1,0].*r00;
r02 = -r20;

r11 = (2*th1 - 4*th1^2*([0,-0.268,-1;0.268,0,0.268-1;1,1-0.268,0].^2)).*r00;
r22 = (2*th2 - 4*th2^2*([0,-1,-0.268;1,0,1-0.268;0.268,0.268-1,0].^2)).*r00;
r12 = -4*th1*th2 * [ 0,0.268,0.268;0.268,0,-0.732*0.732;0.268,-0.732*0.762,0].*r00;
r21 = r12';

%R = [r00,r01,r02;
%     r10,r11,r12;
%     r20,r21,r22];
  R = [r00(1,1),r01(1,1),r02(1,1),r00(1,2),r01(1,2),r02(1,2),r00(1,3),r01(1,3),r02(1,3);
     r10(1,1),r11(1,1),r12(1,1),r10(1,2),r11(1,2),r12(1,2),r10(1,3),r11(1,3),r12(1,3);
     r20(1,1),r21(1,1),r22(1,1),r20(1,2),r21(1,2),r22(1,2),r20(1,3),r21(1,3),r22(1,3);
	  r00(2,1),r01(2,1),r02(2,1),r00(2,2),r01(2,2),r02(2,2),r00(2,3),r01(2,3),r02(2,3);
     r10(2,1),r11(2,1),r12(2,1),r10(2,2),r11(2,2),r12(2,2),r10(2,3),r11(2,3),r12(2,3);
     r20(2,1),r21(2,1),r22(2,1),r20(2,2),r21(2,2),r22(2,2),r20(2,3),r21(2,3),r22(2,3);
	  r00(3,1),r01(3,1),r02(3,1),r00(3,2),r01(3,2),r02(3,2),r00(3,3),r01(3,3),r02(3,3);
     r10(3,1),r11(3,1),r12(3,1),r10(3,2),r11(3,2),r12(3,2),r10(3,3),r11(3,3),r12(3,3);
     r20(3,1),r21(3,1),r22(3,1),r20(3,2),r21(3,2),r22(3,2),r20(3,3),r21(3,3),r22(3,3)];
     
  v=[1,0,0,1,0,0,1,0,0]';

%v=[1,1,1,0,0,0,0,0,0]';
%y=[3.0489,71.6374,93.1663,12.1970,185.7917,123.6169,27.4428, 64.1853,244.4854]';

  y=[3.0489,12.1970,27.4428,71.6374,185.7917,64.1853,93.1663,123.6169,244.4854]';
  mu=69.15;
  b = inv(R)*(y-mu*v);
  
  x0=[1,1];
  
 a=[0:0.05:1]';
 
 [t1,t2]=meshgrid(a,a);


  
  r01 = exp(-th1*(t1-x(1,1)).^2-th2*(t2-x(1,2)).^2);
  r11 = -2*th1*(x(1,1)-t1).*r01;
  r21 = -2*th2*(x(1,2)-t2).*r01;
  
  r02 = exp(-th1*(t1-x(2,1)).^2-th2*(t2-x(2,2)).^2);
  r12 = -2*th1*(x(2,1)-t1).*r02;
  r22 = -2*th2*(x(2,2)-t2).*r02;
  
  r03 = exp(-th1*(t1-x(3,1)).^2-th2*(t2-x(3,2)).^2);
  r13 = -2*th1*(x(3,1)-t1).*r03;
  r23 = -2*th2*(x(3,2)-t2).*r03;
  
 
  
  yhat = mu+b(1)*r01+b(2)*r11+b(3)*r21 + b(4)*r02+b(5)*r12+b(6)*r22 ...
     + b(7)*r03+b(8)*r13+b(9)*r23;
  figure(1)
  subplot(223)
 mesh(t1,t2,yhat)
xlabel('x_1')
ylabel('x_8')
zlabel('y(x)')
title('(c) 3D plot of estimated response')

subplot(224) 
[c,h]=contour(t1,t2,yhat,[10,25,50,75,100,150,200]);
hold on
plot(0,0,'*',0.2680,1,'*',1,0.2680,'*')

clabel(c,h,'manual')
xlabel('x_1')
ylabel('x_8')
title('(d) Contour Plot of Response')



